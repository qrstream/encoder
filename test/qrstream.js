'use strict';

var {Base64} = require('js-base64');

const fs = require('fs');
const mock = require('mock-fs');
var expect = require('chai').expect;

var md5 = require('md5');

var Encoder = require('../index');

describe('#qrstream', function() {
  it('should return correct payload for text', function() {
    var content = "Hello world";
    var qrstream = Encoder(500);
    qrstream.load("text", content);
    const base64 = Base64.encode(content);
    const payload = qrstream.metadata.payload
    expect(payload.content).to.equal(base64);
    expect(payload.size).to.equal(base64.length);
    expect(payload.md5sum).to.equal(md5(base64));
  });

  it('should return correct payload for file', function() {
    var qrstream = Encoder(500);
    var content = "This content is for mock file!";
    mock({
      'mock.file': content
    });
    qrstream.load("file", content, "mock.file");
    const payload = qrstream.metadata.payload
    const base64 = Base64.encode(content);
    expect(payload.content).to.equal(base64);
    expect(payload.size).to.equal(base64.length);
    expect(payload.md5sum).to.equal(md5(base64));
    mock.restore();
  });

  it('should return errorCode -1', function() {
    var qrstream = Encoder(500);
    var errorCode = qrstream.load("WRONG_TYPE", "", "");
    expect(errorCode).to.equal(-1);
  });

  it('should return errorCode -1', function() {
    var qrstream = Encoder(500);
    var errorCode = qrstream.load(undefined, "", "");
    expect(errorCode).to.equal(-1);
  });

  it('should encode correctly', function() {
    var qrstream = Encoder(500);
    var errorCode = qrstream.load("TEXT", "Hello world");
    let {meta, images} = qrstream.encode();
    expect(meta).to.equal("data:image/gif;base64,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");
    expect(images.length).to.equal(1);
    expect(images[0]).to.equal("data:image/gif;base64,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");
  });
});